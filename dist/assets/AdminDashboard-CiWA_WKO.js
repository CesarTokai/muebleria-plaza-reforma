import{_ as ie,r as b,a as W,o as le,c as l,b as e,d as q,e as d,t as u,F as x,f as E,w as z,T as L,g as n,h as re,u as ne,i as r,n as I,j as de,k as _,l as S,m as g,v as p,p as ue,q as ce,s as me,x as ge,y as be}from"./index-jxOkY_Y2.js";const pe={class:"admin-dashboard"},fe={class:"dashboard-content"},ve={key:0,class:"loading-container"},ye={key:1,class:"content-wrapper"},Ce={class:"actions-bar"},ke={class:"stats-summary"},_e={class:"stat-item"},he={class:"categories-section"},we={key:0,class:"categories-grid"},xe={class:"cat-mid"},Ee={class:"cat-name"},Se={class:"muted small"},Te={class:"cat-actions"},$e=["onClick"],Me=["onClick"],Ae={key:1,class:"empty-state small"},De={key:0,class:"table-container"},Ne={class:"furniture-table"},Ve={"data-label":"Imagen",class:"img-cell"},Ie={class:"img-wrapper"},Fe=["src"],Ue={key:1,class:"no-image"},We={"data-label":"Nombre",class:"name-cell"},qe={"data-label":"Precio",class:"price-cell"},ze={"data-label":"Categoría"},Le={class:"category-badge"},je={"data-label":"Stock"},Be={"data-label":"Marca"},Pe={"data-label":"Color"},Re={"data-label":"Material"},Ge={"data-label":"Dimensiones"},Oe={"data-label":"Acciones",class:"actions-cell"},Ke=["onClick"],He=["onClick"],Je={key:1,class:"empty-state"},Xe={class:"modal-form"},Ye={class:"form-header"},Qe={class:"form-body"},Ze={class:"form-grid"},es={class:"form-column"},ss={class:"form-group"},as={class:"form-group"},ts={class:"form-group"},os={class:"category-select-controls"},is=["value"],ls={class:"form-row form-row-compact"},rs={class:"form-group form-group-small"},ns={class:"form-group form-group-small"},ds={class:"form-column sidebar"},us={class:"form-row"},cs={class:"form-group"},ms={class:"form-group"},gs={class:"form-group"},bs={class:"form-group"},ps={class:"form-section-images"},fs={class:"images-count"},vs={class:"image-uploader"},ys={key:0,class:"image-list"},Cs={class:"image-preview-box"},ks=["src"],_s={class:"image-actions"},hs=["onClick"],ws=["onClick"],xs={key:1,class:"error-messages"},Es={class:"form-footer"},Ss={type:"submit",class:"btn-primary"},Ts={class:"modal-card",role:"document"},$s={class:"modal-header"},Ms={class:"header-content"},As={id:"category-modal-title",class:"modal-title"},Ds={key:0,class:"modal-subtitle"},Ns={class:"modal-body"},Vs={class:"form-grid"},Is={class:"form-group"},Fs={class:"form-group"},Us={class:"modal-footer"},Ws={type:"submit",class:"btn btn-primary"},qs={class:"btn-text"},T=5,A=5,zs={__name:"AdminDashboard",setup(Ls){const j=ne(),$=b([]),D=b(!1),B=b(""),v=b(!1),y=b(!1),o=W({id:null,name:"",description:"",price:0,category_id:null,images:[],stock:0,brand:"",color:"",material:"",dimensions:""}),c=b([]),M=b(null),k=b([]),f=b(!1),C=b(!1),m=W({id:null,name:"",description:""});async function h(){try{k.value=await re()}catch(t){console.error("Error cargando categorías:",t)}}function P(){localStorage.removeItem("token"),j.push("/login")}async function N(){D.value=!0;try{const t=await n.doGet("/furniture/");$.value=t.data}catch{B.value="Error al cargar muebles"}finally{D.value=!1}}async function F(){y.value=!1,await h(),Object.assign(o,{id:null,name:"",description:"",price:0,category_id:null,images:[],stock:0,brand:"",color:"",material:"",dimensions:""}),v.value=!0}function R(t){y.value=!0;const s=t.category_id||t.category&&(t.category.id||t.category);let a=[];t.images&&Array.isArray(t.images)&&t.images.length>0?a=t.images.map(i=>typeof i=="string"?i:i.img_base64||i.url||i).filter(Boolean):t.img_base64&&(a=[t.img_base64]),Object.assign(o,{...t,category_id:s,images:a}),c.value=[],v.value=!0}function V(){C.value=!1,Object.assign(m,{id:null,name:"",description:""}),f.value=!0}function G(t){C.value=!0,Object.assign(m,{id:t.id,name:t.name,description:t.description||""}),f.value=!0}async function O(){if(!m.name||!m.name.trim()){n.ToastWarning("Validación","El nombre es obligatorio");return}const t={name:m.name.trim(),description:m.description||void 0};try{if(C.value){const s=await me(m.id,t);n.ToastSuccess("Actualizado","Categoría actualizada correctamente"),await h(),s&&s.id&&(o.category_id===s.id||!o.category_id)&&(o.category_id=s.id)}else{const s=await ge(t);n.ToastSuccess("Creado","Categoría creada correctamente"),await h(),s&&s.id&&(o.category_id=s.id)}f.value=!1}catch(s){console.error(s),s.response&&s.response.status===409?n.ToastWarning("Conflicto","Ya existe una categoría con ese nombre"):s.response&&s.response.data?n.ToastWarning("Error",JSON.stringify(s.response.data)):n.ToastError("Error","No se pudo guardar la categoría")}}function K(t){confirm(`¿Eliminar la categoría "${t.name}"?`)&&H(t.id)}async function H(t){try{await be(t),n.ToastSuccess("Eliminado","Categoría eliminada correctamente"),h()}catch(s){console.error(s),s.response&&s.response.status===400?n.ToastWarning("No se puede eliminar","La categoría tiene muebles asociados"):n.ToastError("Error","No se pudo eliminar la categoría")}}function J(){if(!o.name.trim())return n.ToastWarning("Validación","El nombre del mueble es obligatorio."),!1;if(o.price<=0)return n.ToastWarning("Validación","El precio debe ser mayor a 0."),!1;if(!o.category_id)return n.ToastWarning("Validación","La categoría es obligatoria."),!1;const t=Number(o.category_id);return k.value.some(a=>Number(a.id)===t)?o.stock<0?(n.ToastWarning("Validación","El stock no puede ser negativo."),!1):!0:(n.ToastWarning("Validación","La categoría seleccionada no es válida. Selecciona una categoría existente."),!1)}async function X(){if(!J())return;const t={name:o.name,description:o.description||"",price:parseFloat(o.price),category_id:parseInt(o.category_id),images:o.images||[],stock:parseInt(o.stock)||0,brand:o.brand||"",color:o.color||"",material:o.material||"",dimensions:o.dimensions||""};try{y.value?(await n.doPut(`/furniture/${o.id}/`,t),n.ToastSuccess("¡Éxito!","Mueble actualizado correctamente.")):(await n.doPost("/furniture/",t),n.ToastSuccess("¡Éxito!","Mueble creado correctamente.")),v.value=!1,N()}catch(s){console.error("Error al guardar:",s),n.ToastError("Error","No se pudo guardar el mueble.")}}async function Y(t){if(confirm("¿Seguro que deseas eliminar este mueble?"))try{await n.doDelete(`/furniture/${t}/`),n.ToastSuccess("¡Éxito!","Mueble eliminado correctamente."),N()}catch(s){console.error("Error al eliminar:",s)}}function Q(t){const s=t.target.files;if(s.length){if(o.images.length+s.length>T){n.ToastWarning("Límite de imágenes",`Solo se permiten hasta ${T} imágenes.`);return}c.value=[],Array.from(s).forEach(a=>{if(!a.type.startsWith("image/")){c.value.push(`${a.name} no es una imagen válida.`);return}if(a.size>A*1024*1024){c.value.push(`${a.name} supera el tamaño máximo de ${A}MB.`);return}const i=new FileReader;i.onload=w=>{o.images.push(w.target.result)},i.onerror=()=>{c.value.push(`Error al leer ${a.name}.`)},i.readAsDataURL(a)}),setTimeout(()=>{M.value&&(M.value.value="")},0)}}function Z(t){o.images.splice(t,1),c.value=[]}function ee(t){if(t===0)return;const[s]=o.images.splice(t,1);o.images.unshift(s)}function se(t){t.preventDefault(),t.stopPropagation()}function ae(t){t.preventDefault(),t.stopPropagation();const s=t.dataTransfer.files;if(s.length){if(o.images.length+s.length>T){n.ToastWarning("Límite de imágenes",`Solo se permiten hasta ${T} imágenes.`);return}c.value=[],Array.from(s).forEach(a=>{if(!a.type.startsWith("image/")){c.value.push(`${a.name} no es una imagen válida.`);return}if(a.size>A*1024*1024){c.value.push(`${a.name} supera el tamaño máximo de ${A}MB.`);return}const i=new FileReader;i.onload=w=>{o.images.push(w.target.result)},i.onerror=()=>{c.value.push(`Error al leer ${a.name}.`)},i.readAsDataURL(a)})}}le(()=>{N(),h()});function te(t){if(!t&&t!==0)return"-";if(typeof t=="object")return t.name||"-";const s=Number(t),a=k.value.find(i=>Number(i.id)===s);return a?a.name:String(t)}function oe(t){return t==null?"":t===0?"stock-empty":t>0&&t<=5?"stock-low":t>5&&t<=20?"stock-medium":t>20?"stock-high":""}function U(t){if(t.images&&Array.isArray(t.images)&&t.images.length>0){const s=t.images[0];return typeof s=="string"?s:s.img_base64||s.url||null}return t.img_base64?t.img_base64:null}return(t,s)=>(r(),l("div",pe,[e("div",{class:"dashboard-header"},[e("div",{class:"header-content"},[s[20]||(s[20]=e("div",{class:"header-title-section"},[e("i",{class:"bi bi-speedometer2"}),e("div",null,[e("h1",null,"Panel de Administración"),e("p",null,"Gestiona tu inventario de muebles")])],-1)),e("button",{onClick:P,class:"logout-btn"},s[19]||(s[19]=[e("i",{class:"bi bi-box-arrow-right"},null,-1),d(" Cerrar sesión ")]))])]),e("div",fe,[D.value?(r(),l("div",ve,s[21]||(s[21]=[e("div",{class:"spinner"},null,-1),e("p",null,"Cargando muebles...",-1)]))):(r(),l("div",ye,[e("div",Ce,[e("div",{class:"actions-left"},[e("button",{onClick:F,class:"btn-primary"},s[22]||(s[22]=[e("i",{class:"bi bi-plus-circle"},null,-1),d(" Agregar Mueble ")])),e("button",{onClick:V,class:"btn-secondary",style:{"margin-left":"0.75rem"}},s[23]||(s[23]=[e("i",{class:"bi bi-tags"},null,-1),d(" Nueva Categoría ")]))]),e("div",ke,[e("div",_e,[s[24]||(s[24]=e("i",{class:"bi bi-box-seam"},null,-1)),e("span",null,u($.value.length)+" productos",1)])])]),e("div",he,[s[31]||(s[31]=e("div",{class:"section-header"},[e("h2",null,"Categorías"),e("p",{class:"muted"},"Gestiona las categorías disponibles en el catálogo")],-1)),k.value.length?(r(),l("div",we,[(r(!0),l(x,null,E(k.value,a=>(r(),l("div",{key:a.id,class:"category-card-mini"},[s[27]||(s[27]=e("div",{class:"cat-left"},[e("div",{class:"icon-area-small"},[e("div",{class:"no-icon-small"},[e("i",{class:"bi bi-tags"})])])],-1)),e("div",xe,[e("strong",Ee,u(a.name),1),e("div",Se,u(a.description||"-"),1)]),e("div",Te,[e("button",{class:"btn-icon",onClick:i=>G(a)},s[25]||(s[25]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,$e),e("button",{class:"btn-icon btn-delete",onClick:i=>K(a)},s[26]||(s[26]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Me)])]))),128))])):(r(),l("div",Ae,[s[28]||(s[28]=e("i",{class:"bi bi-inbox"},null,-1)),s[29]||(s[29]=e("h4",null,"No hay categorías",-1)),s[30]||(s[30]=e("p",null,"Añade categorías para organizar tus muebles",-1)),e("button",{class:"btn-primary",onClick:V},"Crear Categoría")]))]),$.value.length?(r(),l("div",De,[e("table",Ne,[s[35]||(s[35]=e("thead",null,[e("tr",null,[e("th",null,"Imagen"),e("th",null,"Nombre"),e("th",null,"Precio"),e("th",null,"Categoría"),e("th",null,"Stock"),e("th",null,"Marca"),e("th",null,"Color"),e("th",null,"Material"),e("th",null,"Dimensiones"),e("th",null,"Acciones")])],-1)),e("tbody",null,[(r(!0),l(x,null,E($.value,a=>(r(),l("tr",{key:a.id,class:"table-row"},[e("td",Ve,[e("div",Ie,[U(a)?(r(),l("img",{key:0,src:U(a),alt:"img"},null,8,Fe)):(r(),l("div",Ue,s[32]||(s[32]=[e("i",{class:"bi bi-image"},null,-1)])))])]),e("td",We,u(a.name),1),e("td",qe,"$"+u(a.price.toLocaleString("es-MX")),1),e("td",ze,[e("span",Le,u(te(a.category_id||a.category)),1)]),e("td",je,[e("span",{class:I(["stock-badge",oe(a.stock)])},u(a.stock),3)]),e("td",Be,u(a.brand||"-"),1),e("td",Pe,[e("span",{class:"color-dot",style:de({background:a.color||"#ccc"})},null,4),d(" "+u(a.color||"-"),1)]),e("td",Re,u(a.material||"-"),1),e("td",Ge,u(a.dimensions||"-"),1),e("td",Oe,[e("button",{onClick:i=>R(a),class:"btn-icon btn-edit",title:"Editar"},s[33]||(s[33]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,Ke),e("button",{onClick:i=>Y(a.id),class:"btn-icon btn-delete",title:"Eliminar"},s[34]||(s[34]=[e("i",{class:"bi bi-trash"},null,-1)]),8,He)])]))),128))])])])):(r(),l("div",Je,[s[37]||(s[37]=e("i",{class:"bi bi-inbox"},null,-1)),s[38]||(s[38]=e("h3",null,"No hay muebles registrados",-1)),s[39]||(s[39]=e("p",null,"Comienza agregando tu primer producto",-1)),e("button",{onClick:F,class:"btn-primary"},s[36]||(s[36]=[e("i",{class:"bi bi-plus-circle"},null,-1),d(" Agregar Mueble ")]))]))]))]),q(L,{name:"modal"},{default:z(()=>[v.value?(r(),l("div",{key:0,class:"modal-overlay",onClick:s[12]||(s[12]=S(a=>v.value=!1,["self"]))},[e("div",Xe,[e("form",{onSubmit:S(X,["prevent"])},[e("div",Ye,[e("h2",null,[e("i",{class:I(y.value?"bi bi-pencil-square":"bi bi-plus-square")},null,2),d(" "+u(y.value?"Editar Mueble":"Nuevo Mueble"),1)]),e("button",{type:"button",onClick:s[0]||(s[0]=a=>v.value=!1),class:"close-btn"},s[40]||(s[40]=[e("i",{class:"bi bi-x-lg"},null,-1)]))]),e("div",Qe,[e("div",Ze,[e("div",es,[e("div",ss,[s[41]||(s[41]=e("label",{for:"name"},[e("i",{class:"bi bi-card-heading"}),d(" Nombre del mueble * ")],-1)),g(e("input",{id:"name","onUpdate:modelValue":s[1]||(s[1]=a=>o.name=a),placeholder:"Ej: Silla ergonómica",required:""},null,512),[[p,o.name]])]),e("div",as,[s[42]||(s[42]=e("label",{for:"price"},[e("i",{class:"bi bi-currency-dollar"}),d(" Precio * ")],-1)),g(e("input",{id:"price","onUpdate:modelValue":s[2]||(s[2]=a=>o.price=a),type:"number",placeholder:"1500",required:""},null,512),[[p,o.price,void 0,{number:!0}]])]),e("div",ts,[s[45]||(s[45]=e("label",{for:"category"},[e("i",{class:"bi bi-tags"}),d(" Categoría * ")],-1)),e("div",os,[g(e("select",{id:"category","onUpdate:modelValue":s[3]||(s[3]=a=>o.category_id=a),required:""},[s[43]||(s[43]=e("option",{value:null,disabled:""},"Selecciona una categoría",-1)),(r(!0),l(x,null,E(k.value,a=>(r(),l("option",{key:a.id,value:a.id},u(a.name),9,is))),128))],512),[[ue,o.category_id]]),e("button",{type:"button",class:"btn-icon small",title:"Crear categoría",onClick:V},s[44]||(s[44]=[e("i",{class:"bi bi-plus-lg"},null,-1)]))])]),e("div",ls,[e("div",rs,[s[46]||(s[46]=e("label",{for:"stock"},[e("i",{class:"bi bi-box"}),d(" Stock ")],-1)),g(e("input",{id:"stock","onUpdate:modelValue":s[4]||(s[4]=a=>o.stock=a),type:"number",placeholder:"20"},null,512),[[p,o.stock,void 0,{number:!0}]])]),e("div",ns,[s[47]||(s[47]=e("label",{for:"brand"},[e("i",{class:"bi bi-award"}),d(" Marca ")],-1)),g(e("input",{id:"brand","onUpdate:modelValue":s[5]||(s[5]=a=>o.brand=a),placeholder:"IKEA"},null,512),[[p,o.brand]])])])]),e("div",ds,[e("div",us,[e("div",cs,[s[48]||(s[48]=e("label",{for:"color"},[e("i",{class:"bi bi-palette"}),d(" Color ")],-1)),g(e("input",{id:"color","onUpdate:modelValue":s[6]||(s[6]=a=>o.color=a),placeholder:"Blanco"},null,512),[[p,o.color]])]),e("div",ms,[s[49]||(s[49]=e("label",{for:"material"},[e("i",{class:"bi bi-tree"}),d(" Material ")],-1)),g(e("input",{id:"material","onUpdate:modelValue":s[7]||(s[7]=a=>o.material=a),placeholder:"Madera"},null,512),[[p,o.material]])])]),e("div",gs,[s[50]||(s[50]=e("label",{for:"dimensions"},[e("i",{class:"bi bi-rulers"}),d(" Dimensiones ")],-1)),g(e("input",{id:"dimensions","onUpdate:modelValue":s[8]||(s[8]=a=>o.dimensions=a),placeholder:"120x60x80 cm"},null,512),[[p,o.dimensions]])]),e("div",bs,[s[51]||(s[51]=e("label",{for:"description"},[e("i",{class:"bi bi-text-paragraph"}),d(" Descripción ")],-1)),g(e("textarea",{id:"description","onUpdate:modelValue":s[9]||(s[9]=a=>o.description=a),placeholder:"Describe las características del mueble...",rows:"3"},null,512),[[p,o.description]])]),e("div",ps,[s[58]||(s[58]=e("h3",null,[e("i",{class:"bi bi-images"}),d(" Galería de imágenes ")],-1)),e("div",fs,u(o.images.length)+" / "+u(T)+" imágenes ",1),e("div",vs,[s[57]||(s[57]=d(" d ")),e("div",{class:"image-drop-area",onDragover:se,onDrop:S(ae,["prevent"])},[s[52]||(s[52]=e("i",{class:"bi bi-cloud-upload"},null,-1)),s[53]||(s[53]=e("p",null,"Arrastra y suelta imágenes aquí o",-1)),e("button",{type:"button",class:"browse-text",onClick:s[10]||(s[10]=a=>M.value.click())}," Selecciona archivos "),e("input",{type:"file",accept:"image/*",multiple:"",ref_key:"fileInputRef",ref:M,class:"hidden-file-input",onChange:Q},null,544)],32),o.images.length?(r(),l("div",ys,[(r(!0),l(x,null,E(o.images,(a,i)=>(r(),l("div",{key:i,class:"image-item"},[e("div",Cs,[e("img",{src:a,alt:"Imagen del mueble"},null,8,ks),e("div",_s,[e("button",{type:"button",class:"btn-icon remove-btn",onClick:w=>Z(i)},s[54]||(s[54]=[e("i",{class:"bi bi-x-circle"},null,-1)]),8,hs),y.value?_("",!0):(r(),l("button",{key:0,type:"button",class:"btn-icon main-btn",onClick:w=>ee(i)},s[55]||(s[55]=[e("i",{class:"bi bi-star"},null,-1)]),8,ws))])])]))),128))])):_("",!0),c.value.length?(r(),l("div",xs,[(r(!0),l(x,null,E(c.value,(a,i)=>(r(),l("div",{key:i,class:"error-message"},[s[56]||(s[56]=e("i",{class:"bi bi-exclamation-circle"},null,-1)),d(" "+u(a),1)]))),128))])):_("",!0)])])])])]),e("div",Es,[e("button",{type:"button",onClick:s[11]||(s[11]=a=>v.value=!1),class:"btn-secondary"},s[59]||(s[59]=[e("i",{class:"bi bi-x-circle"},null,-1),d(" Cancelar ")])),e("button",Ss,[s[60]||(s[60]=e("i",{class:"bi bi-check-circle"},null,-1)),d(" "+u(y.value?"Guardar Cambios":"Crear Mueble"),1)])])],32)])])):_("",!0)]),_:1}),q(L,{name:"modal"},{default:z(()=>[f.value?(r(),l("div",{key:0,class:"modal-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"category-modal-title",onKeydown:s[17]||(s[17]=ce(a=>f.value=!1,["esc"])),onClick:s[18]||(s[18]=S(a=>f.value=!1,["self"]))},[e("div",Ts,[e("form",{onSubmit:S(O,["prevent"]),novalidate:""},[e("header",$s,[e("div",Ms,[s[61]||(s[61]=e("div",{class:"icon-wrapper","aria-hidden":"true"},[e("i",{class:"bi bi-folder-plus"})],-1)),e("h2",As,u(C.value?"Editar categoría":"Crear categoría"),1),C.value?(r(),l("p",Ds,"Actualiza los datos de la categoría")):_("",!0)]),e("button",{type:"button",class:"close-btn",onClick:s[13]||(s[13]=a=>f.value=!1),"aria-label":"Cerrar formulario"},s[62]||(s[62]=[e("i",{class:"bi bi-x-lg","aria-hidden":"true"},null,-1)]))]),e("main",Ns,[e("div",Vs,[e("div",Is,[s[63]||(s[63]=e("label",{for:"category-name"},[d(" Nombre "),e("span",{class:"required","aria-hidden":"true"},"*")],-1)),g(e("input",{id:"category-name","onUpdate:modelValue":s[14]||(s[14]=a=>m.name=a),type:"text",placeholder:"Ej: Tecnología, Hogar, etc.",required:"","aria-required":"true"},null,512),[[p,m.name]])]),e("div",Fs,[s[64]||(s[64]=e("label",{for:"category-description"},"Descripción",-1)),g(e("textarea",{id:"category-description","onUpdate:modelValue":s[15]||(s[15]=a=>m.description=a),rows:"4",placeholder:"Describe esta categoría (opcional)"},null,512),[[p,m.description]])])])]),e("footer",Us,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[16]||(s[16]=a=>f.value=!1)}," Cancelar "),e("button",Ws,[e("i",{class:I(["bi",C.value?"bi-check-lg":"bi-plus-lg"]),"aria-hidden":"true"},null,2),e("span",qs,u(C.value?"Guardar cambios":"Crear categoría"),1)])])],32)])],32)):_("",!0)]),_:1})]))}},Bs=ie(zs,[["__scopeId","data-v-17226c46"]]);export{Bs as default};
